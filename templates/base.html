<!doctype html>
<html lang="en" class="dark">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>{{ title or "English Learning" }}</title>

  <link rel="stylesheet" href="/static/style.css">
  <link rel="stylesheet" href="/static/app.css"/>

  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    .accent-ring:focus { outline: none; box-shadow: 0 0 0 3px color-mix(in srgb, var(--accent) 35%, transparent); }
  </style>
</head>

<body class="bg-slate-50 text-slate-900 dark:bg-slate-950 dark:text-slate-100">
  <header class="sticky top-0 z-10 border-b border-slate-200 bg-white/90 backdrop-blur
                 dark:border-slate-800 dark:bg-slate-950/90">
    <div class="mx-auto max-w-6xl px-4 py-4 flex items-center justify-between gap-3">
      <div>
        <div class="text-lg font-extrabold tracking-tight">ENGLISH LEARNING</div>
        <div class="text-xs text-slate-500 dark:text-slate-400">Lessons + Practice + Books + Admin</div>
      </div>

      <div class="flex items-center gap-2">
        <button id="themeBtn"
                class="px-3 py-2 rounded-xl border border-slate-200 hover:border-slate-400
                       dark:border-slate-800 dark:hover:border-slate-600 accent-ring">
          Mode
        </button>

        <button id="openSettings"
                class="px-3 py-2 rounded-xl border border-slate-200 hover:border-slate-400
                       dark:border-slate-800 dark:hover:border-slate-600 accent-ring"
                title="Settings">
          Settings
        </button>

        <a class="px-3 py-2 rounded-xl border border-slate-200 hover:border-slate-400 dark:border-slate-800 dark:hover:border-slate-600"
           href="/">Home</a>

        <a class="px-3 py-2 rounded-xl border border-slate-200 hover:border-slate-400 dark:border-slate-800 dark:hover:border-slate-600"
           href="/books">Books</a>

        <a class="px-3 py-2 rounded-xl border border-slate-200 hover:border-slate-400 dark:border-slate-800 dark:hover:border-slate-600"
           href="/admin">Admin</a>
      </div>
    </div>
  </header>

  <main class="mx-auto max-w-6xl px-4 py-6">
    {% block content %}{% endblock %}
  </main>

  <!-- SETTINGS MODAL (simple) -->
  <div id="settingsModal" class="fixed inset-0 hidden items-start justify-center p-4 bg-black/40 backdrop-blur-sm z-[100]">
    <div class="w-full max-w-xl mt-16 rounded-3xl border border-slate-200 bg-white shadow-xl overflow-hidden
                dark:border-slate-800 dark:bg-slate-950">
      <div class="p-4 border-b border-slate-200 flex items-center justify-between dark:border-slate-800">
        <div class="font-extrabold">Settings</div>
        <button id="closeSettings" class="px-3 py-2 rounded-xl border border-slate-200 dark:border-slate-800">âœ•</button>
      </div>

      <div class="p-4 space-y-4">
        <div class="rounded-2xl border border-slate-200 p-4 dark:border-slate-800">
          <div class="font-bold mb-2">Accent color</div>
          <div class="flex flex-wrap gap-2">
            <button class="accentBtn px-4 py-2 rounded-xl border border-slate-200 dark:border-slate-800" data-accent="#7c3aed">Violet</button>
            <button class="accentBtn px-4 py-2 rounded-xl border border-slate-200 dark:border-slate-800" data-accent="#2563eb">Blue</button>
            <button class="accentBtn px-4 py-2 rounded-xl border border-slate-200 dark:border-slate-800" data-accent="#f97316">Orange</button>
            <button class="accentBtn px-4 py-2 rounded-xl border border-slate-200 dark:border-slate-800" data-accent="#0f172a">Dark</button>
          </div>
        </div>

        <div class="rounded-2xl border border-slate-200 p-4 dark:border-slate-800">
          <div class="font-bold mb-2">Support</div>
          <div class="text-sm text-slate-500 dark:text-slate-400">
            Phone/WhatsApp/Telegram links can stay here as before.
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // theme
    (function(){
      const root = document.documentElement;
      const key = "itbook_theme";
      const saved = localStorage.getItem(key);
      if (saved === "light") root.classList.remove("dark");
      if (saved === "dark") root.classList.add("dark");
      document.getElementById("themeBtn")?.addEventListener("click", () => {
        root.classList.toggle("dark");
        localStorage.setItem(key, root.classList.contains("dark") ? "dark" : "light");
      });
    })();

    // settings modal
    (function(){
      const modal = document.getElementById("settingsModal");
      const openBtn = document.getElementById("openSettings");
      const closeBtn = document.getElementById("closeSettings");
      function open(){ modal?.classList.remove("hidden"); modal?.classList.add("flex"); }
      function close(){ modal?.classList.add("hidden"); modal?.classList.remove("flex"); }
      openBtn?.addEventListener("click", open);
      closeBtn?.addEventListener("click", close);
      modal?.addEventListener("click", (e) => { if (e.target === modal) close(); });
      document.addEventListener("keydown", (e) => { if (e.key === "Escape") close(); });
    })();

    // accent
    (function(){
      const keyA = "itbook_accent";
      const root = document.documentElement;
      const savedA = localStorage.getItem(keyA);
      if (savedA) root.style.setProperty("--accent", savedA);
      document.querySelectorAll(".accentBtn").forEach(btn => {
        btn.addEventListener("click", () => {
          const a = btn.getAttribute("data-accent");
          if (a) { root.style.setProperty("--accent", a); localStorage.setItem(keyA, a); }
        });
      });
    })();
  </script>
</body>
</html>
